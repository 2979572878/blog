<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>项目迁移URL解决方案</title>
    <link rel="stylesheet" href="../../static/bootstrap/3.3.2/bootstrap.min.css">
    <link rel="stylesheet" href="../../static/nimojs-blog/site.css">
    <meta name="keywords" content="Web开发,团队规范,链接失效,项目迁移，项目架构" />
    <meta name="description" content="介绍应对项目迁移的一种解决方案" />
</head>
<body>
<!-- Header S -->
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">Home</a>
    </div>
    <div class="navbar-collapse collapse" role="navigation">
      <ul class="nav navbar-nav navbar-right hidden-sm">
        <li>
        <iframe class="githubstar" src="http://ghbtns.com/github-btn.html?user=nimojs&repo=blog&type=watch&count=true&size=little" allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20">
        </iframe>
        </li>
      </ul>
    </div>
  </div>
</div>
<!-- Header E -->
<div class="container">
<h2 id="-url-">项目迁移URL解决方案</h2>
<!--_PAGEDATA
{
    "title": "项目迁移URL解决方案",
    "githubissuesid": 11,
    "createData": "2015-03-08",
    "keywords": "Web开发,团队规范,链接失效,项目迁移，项目架构",
    "description":"介绍应对项目迁移的一种解决方案"
}
_PAGEDATA-->

<p>此文章是 <a href="https://github.com/nimojs/rain/blob/master/doc/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%BA%A6%E5%AE%9A.md#%E9%A1%B9%E7%9B%AE%E8%BF%81%E7%A7%BB%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">Rain/doc/前后端开发约定</a> 中 <strong>-项目迁移解决方案-</strong> 独立通用版本。</p>
<p>考虑如下场景：</p>
<pre><code class="lang-html"><span class="comment">&lt;!-- 首页代码 --&gt;</span>
您好，请<span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/login/"</span>&gt;</span>登录<span class="tag">&lt;/<span class="title">a</span>&gt;</span></code></pre>
<p>项目是一个博客系统，域名是 <code>http://www.domain.com</code> 登录地址是 <code>http://www.domian.com/login/</code> 。</p>
<p>上线后需求方要求将博客迁移至 <code>http://www.domain.com/blog/</code> 。</p>
<p>迁移后访问首页，点击登录<code>(/login/)</code>。打开 <code>/login/</code> 页面后出现404。因为博客的登录页面变成了 <code>/blog/login/</code>，而页面中的链接没有修改。</p>
<p>此时需要将所有页面中的 URL 都加上 <code>/blog/</code> 前缀才可以确保所有 URL 正确，<code>/login/</code> 改为 <code>/blog/login/</code> 等。</p>
<hr>
<p>当项目迁移至子目录时，因为 URL 前缀固定导致所有页面需要同时修改。我们通过前缀变量的方式解决这个问题。</p>
<p>PHP代码修改如下</p>
<pre><code class="lang-html"><span class="function"><span class="title">define</span><span class="params">(<span class="string">"APP_PATH"</span>,<span class="string">"/"</span>)</span>;
您好，请&lt;<span class="title">a</span> <span class="title">href</span>="&lt;?<span class="title">php</span> <span class="title">echo</span> APP_PATH ?&gt;<span class="title">login</span>/"&gt;登录&lt;/<span class="title">a</span>&gt;</code></pre>
<p>渲染结果:您好，请<code>&lt;a href=&quot;/login/&quot;&gt;登录&lt;/a&gt;</code></p>
<p>此处是原生 PHP 渲染页面示例，不同后端框架渲染页面方式不同。大致都是定义一个常量，每个 URL 都加上此常量。</p>
<p>使用此方案后，可通过修改常量完成所有页面 URL 的迁移。</p>
<pre><code class="lang-html"><span class="function"><span class="title">define</span><span class="params">(<span class="string">"APP_PATH"</span>,<span class="string">"/blog/"</span>)</span>;
您好，请&lt;<span class="title">a</span> <span class="title">href</span>="&lt;?<span class="title">php</span> <span class="title">echo</span> APP_PATH ?&gt;<span class="title">login</span>/"&gt;登录&lt;/<span class="title">a</span>&gt;</code></pre>
<p>渲染结果:您好，请<code>&lt;a href=&quot;/blog/login/&quot;&gt;登录&lt;/a&gt;</code></p>
<p><strong>前端注意：</strong><br>AJAX 路径也需要加上项目路径前缀，防止项目迁移 AJAX 路径错误。参考如下示例：</p>
<pre><code class="lang-php">&lt;script&gt;
<span class="keyword">var</span> APP_PATH = <span class="string">"&lt;?php echo APP_PATH ?&gt;"</span>;
&lt;/script&gt;
&lt;script&gt;
$.get(APP_PATH + <span class="string">'url/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="comment">// ...</span>
})
&lt;/script&gt;</code></pre>
<p>访问Github原文进行讨论：<a href="https://github.com/nimojs/blog/issues/11"><a href="https://github.com/nimojs/blog/issues/11">https://github.com/nimojs/blog/issues/11</a></a></p>


<div id="ghComments" class="ui-comments" 
    data-issue-id="11"
    data-gh-name="nimojs/blog"
>
  <h3>评论</h3>
  <div class="alert alert-warning">
    你可以<a href="https://github.com/nimojs/blog/issues/11" target="_blank">点击此处</a> 添加评论。
  </div>
  <img class="loading" id="ghCommentsLoading" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-64.gif" alt="加载评论中...">

</div>

</div>
<script src="../../static/jquery/1.11.1/jquery.min.js"></script>
<script src="../../static/nimojs-blog/site.js"></script>
</body>
</html>